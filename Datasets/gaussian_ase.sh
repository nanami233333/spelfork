#!/bin/bash

#SBATCH -J gaussian_job          # Job name
#SBATCH -p cpu-share             # Partition name
#SBATCH -N 1                     # Number of nodes
#SBATCH -n 40                    # Number of cores


export PATH=/opt/ohpc/pub/apps/anaconda3-2021.05/bin:${PATH}
export PYTHONPATH=/opt/ohpc/pub/apps/anaconda3-2021.05:$PYTHONPATH

# Environment setup for Gaussian
export PATH=/home/mejiadongs/jiadongshen/g16:$PATH
export g16root=/home/mejiadongs/jiadongshen
export GAUSS_SCRDIR=$PWD/gaussian_scratch
source $g16root/g16/bsd/g16.profile

# Ensure the Gaussian scratch and log directories exist
mkdir -p $GAUSS_SCRDIR
LOG_DIR=$PWD/logs
mkdir -p $LOG_DIR

# Define the location of the Python script
PYTHON_SCRIPT="$PWD/gaussian_go.py"  # Ensure this points to the correct script

# Execute the Python script
python $PYTHON_SCRIPT

# Run Gaussian on each .gjf file generated by the Python script in the current directory
for gjf_file in *.gjf; do
    log_file="${LOG_DIR}/$(basename "$gjf_file" .gjf).log"
    g16 < "$gjf_file" > "$log_file"
done

# Clean up the scratch directory after computations
rm -rf $GAUSS_SCRDIR

